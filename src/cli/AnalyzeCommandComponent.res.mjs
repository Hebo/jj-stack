// Generated by ReScript, PLEASE EDIT WITH CARE

import * as $$Ink from "ink";
import * as Utils from "./Utils.res.mjs";
import * as React from "react";
import * as Caml_obj from "rescript/lib/es6/caml_obj.js";
import * as Core__Array from "@rescript/core/src/Core__Array.res.mjs";
import * as Core__Option from "@rescript/core/src/Core__Option.res.mjs";
import * as JsxRuntime from "react/jsx-runtime";

function AnalyzeCommandComponent(props) {
  var onSelect = props.onSelect;
  var topSort = props.topSort;
  var output = props.output;
  var changeGraph = props.changeGraph;
  var match = React.useState(function () {
        return Core__Option.mapOr(output[0], undefined, (function (outputRow) {
                      return outputRow.changeId;
                    }));
      });
  var setSelectedChangeId = match[1];
  var selectedChangeId = match[0];
  $$Ink.useInput((function (param, key) {
          if (selectedChangeId !== undefined) {
            if (key.upArrow) {
              var selectedChangeIdRowIdx = Core__Option.getExn(Core__Array.findIndexOpt(topSort, (function (changeId) {
                          return changeId === selectedChangeId;
                        })), undefined);
              if (selectedChangeIdRowIdx > 0) {
                setSelectedChangeId(function (param) {
                      return Core__Option.getExn(topSort[selectedChangeIdRowIdx - 1 | 0], undefined);
                    });
              }
              
            } else if (key.downArrow) {
              var selectedChangeIdRowIdx$1 = Core__Option.getExn(Core__Array.findIndexOpt(topSort, (function (changeId) {
                          return changeId === selectedChangeId;
                        })), undefined);
              if (selectedChangeIdRowIdx$1 < (topSort.length - 1 | 0)) {
                setSelectedChangeId(function (param) {
                      return Core__Option.getExn(topSort[selectedChangeIdRowIdx$1 + 1 | 0], undefined);
                    });
              }
              
            } else if (key.return) {
              onSelect(selectedChangeId);
            }
            
          }
          
        }), undefined);
  var selectedChangeIdAncestors = new Set();
  if (selectedChangeId !== undefined) {
    selectedChangeIdAncestors.add(selectedChangeId);
    var cur = selectedChangeId;
    while(changeGraph.bookmarkedChangeAdjacencyList.has(cur)) {
      var parentChangeId = Core__Option.getExn(changeGraph.bookmarkedChangeAdjacencyList.get(cur), undefined);
      selectedChangeIdAncestors.add(parentChangeId);
      cur = parentChangeId;
    };
  }
  return JsxRuntime.jsxs(React.Fragment, {
              children: [
                output.map(function (line) {
                      var changeId = line.changeId;
                      var tmp;
                      if (changeId !== undefined) {
                        var bookmarksStr = " (" + Utils.changeIdToLogEntry(changeGraph, changeId).localBookmarks.join(", ") + ")";
                        tmp = JsxRuntime.jsxs($$Ink.Text, {
                              children: [
                                JsxRuntime.jsx($$Ink.Text, {
                                      children: " " + changeId + bookmarksStr,
                                      color: selectedChangeIdAncestors.has(changeId) ? "red" : undefined
                                    }),
                                Caml_obj.equal(line.changeId, selectedChangeId) ? " ← press enter to select this stack" : null
                              ]
                            });
                      } else {
                        tmp = null;
                      }
                      return JsxRuntime.jsxs($$Ink.Text, {
                                  children: [
                                    JsxRuntime.jsx($$Ink.Text, {
                                          children: line.chars.join("")
                                        }),
                                    tmp
                                  ]
                                });
                    }),
                JsxRuntime.jsx($$Ink.Text, {
                      children: " ○ trunk()\n"
                    })
              ]
            });
}

var $$Text;

var make = AnalyzeCommandComponent;

export {
  $$Text ,
  make ,
}
/* ink Not a pure module */
